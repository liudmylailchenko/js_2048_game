{"version":3,"sources":["scripts/main.js"],"names":["Game","tableSize","numberElements","handleMove","bind","start","initSelectors","initListeners","tableEl","document","querySelector","scoreEl","messageLoseEl","messageWinEl","messageStartEl","startButtonEl","window","addEventListener","y","row","createElement","classList","add","append","x","cell","score","gameOver","hasWon","matrix","Array","fill","map","contains","remove","textContent","addNumber","render","Math","random","freeCells","getFreeCells","floor","length","reduce","rowIndex","forEach","val","colIndex","push","getRandomCell","getRandomNumber","emptyCells","filter","el","concat","slice","degree","_","reverse","Error","event","key","merge","matrixRotate","matrixRef","some","matrixShift","hasMatrixChanged","rows","className","arr","cellIndex","field","cells","setTimeout","canMove","game","init"],"mappings":"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","file":"main.77b84732.js","sourceRoot":"../src","sourcesContent":["'use strict';\n\nclass Game {\n  constructor(tableSize = 4) {\n    this.tableSize = tableSize;\n    this.numberElements = [];\n\n    this.handleMove = this.handleMove.bind(this);\n    this.start = this.start.bind(this);\n\n    this.initSelectors();\n    this.initListeners();\n  }\n\n  /**\n   * Save references to the DOM elements\n   */\n  initSelectors() {\n    this.tableEl = document.querySelector('table');\n    this.scoreEl = document.querySelector('.game-score');\n    this.messageLoseEl = document.querySelector('.message-lose');\n    this.messageWinEl = document.querySelector('.message-win');\n    this.messageStartEl = document.querySelector('.message-start');\n    this.startButtonEl = document.querySelector('.button');\n  }\n\n  /**\n   * Initialize event listeners\n   */\n  initListeners() {\n    window.addEventListener('keyup', this.handleMove);\n    this.startButtonEl.addEventListener('click', this.start);\n  }\n\n  /**\n   * Dynamically render table with given size\n   */\n  init() {\n    for (let y = 0; y < this.tableSize; y++) {\n      const row = document.createElement('tr');\n\n      row.classList.add('field-row');\n      this.tableEl.append(row);\n\n      for (let x = 0; x < this.tableSize; x++) {\n        const cell = document.createElement('td');\n\n        cell.classList.add('field-cell');\n        row.append(cell);\n      }\n    }\n  }\n\n  /**\n   * Start/restart the game\n   */\n  start() {\n    this.score = 0;\n    this.gameOver = false;\n    this.hasWon = false;\n\n    this.matrix = new Array(this.tableSize)\n      .fill([])\n      .map(() => new Array(this.tableSize).fill(0));\n\n    this.messageLoseEl.classList.add('hidden');\n    this.messageWinEl.classList.add('hidden');\n\n    if (this.startButtonEl.classList.contains('start')) {\n      this.startButtonEl.classList.remove('start');\n      this.startButtonEl.classList.add('restart');\n      this.startButtonEl.textContent = 'Restart';\n      this.messageStartEl.classList.add('hidden');\n    }\n\n    this.addNumber();\n    this.addNumber();\n    this.render();\n  }\n\n  /**\n   * Get random number (2 or 4)\n   */\n  getRandomNumber() {\n    return Math.random() >= 0.9 ? 4 : 2;\n  }\n\n  /**\n   * Get random free cell\n   */\n  getRandomCell() {\n    const freeCells = this.getFreeCells();\n\n    return freeCells[Math.floor(Math.random() * freeCells.length)];\n  }\n\n  /**\n   * Look for cells with value of 0\n   * and save their coordinates as [y, x]\n   */\n  getFreeCells() {\n    return this.matrix.reduce((freeCells, row, rowIndex) => {\n      row.forEach(\n        (val, colIndex) => val === 0 && freeCells.push([rowIndex, colIndex])\n      );\n\n      return freeCells;\n    }, []);\n  }\n\n  /**\n   * Add random number (2 or 4) into a random free cell\n   */\n  addNumber() {\n    // Get coordinates of a random free cell\n    const [y, x] = this.getRandomCell();\n\n    // Add a new number to the matrix using known coordinates\n    this.matrix[y][x] = this.getRandomNumber();\n    this.render();\n  }\n\n  /**\n   * Check if it's possible to make a move\n   */\n  canMove() {\n    // First check if there are free cells\n    const freeCells = this.getFreeCells();\n\n    if (freeCells.length > 0) {\n      return true;\n    }\n\n    // Check if there are two same numbers in a row\n    // (both horizontally and vertically)\n    for (let y = 0; y < this.tableSize; y++) {\n      for (let x = 0; x < this.tableSize; x++) {\n        if (\n          (this.matrix[y][x + 1]\n            && this.matrix[y][x] === this.matrix[y][x + 1])\n          || (this.matrix[y + 1] && this.matrix[y][x] === this.matrix[y + 1][x])\n        ) {\n          return true;\n        }\n      }\n    }\n\n    // Finally return false\n    return false;\n  }\n\n  /**\n   * Shift all non-zero elements of each row to the left\n   */\n  matrixShift() {\n    const emptyCells = new Array(this.tableSize).fill(0);\n\n    this.matrix = this.matrix.map((row) => {\n      return row\n        .filter((el) => el > 0)\n        .concat(emptyCells)\n        .slice(0, this.tableSize);\n    });\n  }\n\n  /**\n   * Rotate matrix to the given degree\n   */\n  matrixRotate(degree) {\n    switch (degree) {\n      case 90:\n      case -270:\n        this.matrix = this.matrix.map((_, rowIndex) =>\n          this.matrix.map((row) => row[rowIndex]).reverse()\n        );\n        break;\n      case 180:\n      case -180:\n        this.matrix = this.matrix.map((row) => row.reverse()).reverse();\n        break;\n      case 270:\n      case -90:\n        this.matrix = this.matrix.map((_, rowIndex) =>\n          this.matrix.map((row) => [...row].reverse()[rowIndex])\n        );\n        break;\n      case 0:\n      case 360:\n      case -360:\n        return this.matrix;\n      default:\n        throw new Error('Degree must be one of 90, -90, 180, -180, 270, -270');\n    }\n  }\n\n  /**\n   * Trigger matrix shift by rotating it\n   * to emulate shifts in different directions\n   *\n   * Examples:\n   * 0 - to emulate shift left\n   * 90 - to emulate shift down\n   * 180 - to emulate shift right\n   * 270 - to emulate shift up\n   */\n  handleMove(event) {\n    // Don't do anything if the game is over\n    if (this.gameOver) {\n      return;\n    }\n\n    switch (event.key) {\n      case 'ArrowLeft':\n        this.merge();\n        this.render();\n        break;\n      case 'ArrowDown':\n        this.matrixRotate(90);\n        this.merge();\n        this.matrixRotate(-90);\n        this.render();\n        break;\n      case 'ArrowRight':\n        this.matrixRotate(180);\n        this.merge();\n        this.matrixRotate(-180);\n        this.render();\n        break;\n      case 'ArrowUp':\n        this.matrixRotate(270);\n        this.merge();\n        this.matrixRotate(-270);\n        this.render();\n        break;\n    }\n  }\n\n  /**\n   * Compare matrixes\n   */\n  hasMatrixChanged(matrixRef) {\n    return this.matrix.some((row, y) =>\n      row.some((val, x) => val !== matrixRef[y][x])\n    );\n  }\n\n  /**\n   * Shift matrix and merge pairs\n   */\n  merge() {\n    // Deeply clone matrix\n    const matrixRef = this.matrix.map((row) => row.slice());\n\n    for (let y = 0; y < this.tableSize; y++) {\n      for (let x = 0; x < this.tableSize - 1; x++) {\n        this.matrixShift();\n\n        if (this.matrix[y][x] === this.matrix[y][x + 1]) {\n          this.matrix[y][x] *= 2;\n          this.matrix[y][x + 1] = 0;\n          this.score += this.matrix[y][x];\n        }\n      }\n    }\n\n    // We don't need to add a new number when nothing has changed\n    // after the move e.g. when all numbers were aligned to the left\n    // and a user pressed the ArrowLeft key\n    if (this.hasMatrixChanged(matrixRef)) {\n      this.addNumber();\n    }\n  }\n\n  /**\n   * Render the matrix and show win/lose messages when needed\n   */\n  render() {\n    const { rows } = this.tableEl;\n\n    this.numberElements.forEach((el) => {\n      el.textContent = '';\n      el.className = 'field-cell';\n    });\n    this.numberElements = [];\n\n    this.matrix.forEach((arr, rowIndex) =>\n      arr.forEach((val, cellIndex) => {\n        if (val) {\n          const field = rows[rowIndex].cells[cellIndex];\n\n          field.textContent = val;\n          field.classList.add(`field-cell--${val}`);\n          this.numberElements.push(field);\n          this.scoreEl.textContent = this.score;\n        }\n      })\n    );\n\n    // Show a win massage when 2048 has been collected\n    if (\n      this.matrix.some((row) => row.some((el) => el === 2048))\n      && !this.hasWon\n    ) {\n      this.messageWinEl.classList.remove('hidden');\n      this.hasWon = true;\n\n      setTimeout(() => {\n        this.messageWinEl.classList.add('hidden');\n      }, 10000);\n    }\n\n    // Show a game over massage when there are no possible moves left\n    if (!this.canMove()) {\n      this.messageLoseEl.classList.remove('hidden');\n      this.gameOver = true;\n    }\n  }\n}\n\nconst game = new Game();\n\ngame.init();\n"]}